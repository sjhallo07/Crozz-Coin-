# AWS-specific configurations for EKS deployment
---
# StorageClass for AWS EBS
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: crozz-aws-ebs
provisioner: ebs.csi.aws.com
parameters:
  type: gp3
  encrypted: "true"
  kmsKeyId: "arn:aws:kms:region:account:key/key-id"
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
---
# PersistentVolumeClaim for backend data
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: crozz-backend-data-aws
  namespace: crozz-coin
spec:
  accessModes:
  - ReadWriteOnce
  storageClassName: crozz-aws-ebs
  resources:
    requests:
      storage: 10Gi
---
# Service with AWS Load Balancer annotations
apiVersion: v1
kind: Service
metadata:
  name: crozz-backend-lb-aws
  namespace: crozz-coin
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "tcp"
    service.beta.kubernetes.io/aws-load-balancer-ssl-cert: "arn:aws:acm:region:account:certificate/cert-id"
    service.beta.kubernetes.io/aws-load-balancer-ssl-ports: "443"
spec:
  type: LoadBalancer
  selector:
    app: crozz-backend
  ports:
  - name: https
    port: 443
    targetPort: 4000
    protocol: TCP
---
# IAM Role for Service Account (IRSA)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: crozz-backend-sa-aws
  namespace: crozz-coin
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/crozz-backend-role
---
# ConfigMap with AWS-specific settings
apiVersion: v1
kind: ConfigMap
metadata:
  name: crozz-aws-config
  namespace: crozz-coin
data:
  AWS_REGION: "us-east-1"
  AWS_S3_BUCKET: "crozz-coin-backups"
  ENABLE_AWS_SECRETS_MANAGER: "true"
